<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="tangs">

<!-- <xacro:property name="pi" value="3.141592654"/> -->
<xacro:property name="kp" value="1E12"/>
<xacro:property name="kd" value="10"/>
<xacro:property name="mu1" value="10.0"/>
<xacro:property name="mu2" value="10.0"/>

<!-- Arquivo com a descrição da garra -->
<xacro:include filename="$(find gripper_description)/urdf/gripper.xacro" />

<!-- Properties -->
	
<!-- Argumento para o prefixo TF -->

<xacro:arg name="robot_name" default="tangs" />
<xacro:property name="tf_prefix" value="$(arg robot_name)" />

<!-- <xacro:property name="pi" value="3.141592654"/> -->
<xacro:property name="kp" value="1E12"/>
<xacro:property name="kd" value="10"/>
<xacro:property name="mu1" value="10.0"/>
<xacro:property name="mu2" value="10.0"/>

<!-- Materiais -->
<material name="Gazebo/Grey">
    <color rgba="0.7 0.7 0.7 1.0"/>
</material>

<!-- <material name="link_body_material">
    <color rgba="0.8 0.8 0.8 1.0"/>
</material> -->


<xacro:macro name="tangs_base" params="">

    <link name="${tf_prefix}/world">
    </link>

    <link name="${tf_prefix}/link_base">
        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <mesh filename="package://tangs_description/models/thangs3/link_base.stl"/>
            </geometry>
            <material name="Gazebo/Grey"/> 
        </visual>

        <inertial>
            <origin xyz="0 0 -0.30" rpy="0 0 0"/>
            <mass value="60.620" />
             <!-- <inertia ixx="1.72e-04" ixy="1.50e-09"  ixz="-7.40e-10" iyy="1.60e-04" iyz="4.88e-06" izz="2.60e-04" /> -->
            <xacro:box_inertia mass="60.620" x="0.32" y="0.32" z="0.32"/> 
        
        </inertial>

        <collision>
            <origin xyz="0 0 0.03" rpy="0 0 0" />
            <geometry>
                <!-- <mesh filename="package://tangs_description/models/thangs3/link_base.stl"/> -->
                <box size="0.12 0.12 0.06" />
            </geometry>
        </collision>
    </link>
        
    <gazebo reference="${tf_prefix}/link_base">
        <kp>${kp}</kp> <!-- static contact stiffness - very rigid, bigger values closes to the marble -->
        <kd>${kd}</kd> <!-- static dynamic stiffness very rigid, bigger values closes to the marble -->
        <mu1>${mu1}</mu1> <!-- Static Friction Coeficient -->
        <mu2>${mu2}</mu2> <!-- Dynamic Friction Coeficient -->
        <material>Gazebo/Grey</material> 
        <static>true</static>  
        <selfCollide>true</selfCollide>
    </gazebo>    

     <joint name="${tf_prefix}/base_joint" type="fixed">
        <parent link="${tf_prefix}/world"/>
        <child link="${tf_prefix}/link_base"/>
        <origin xyz="0.0 0 0.0" rpy="0 0 0"/>
    </joint>        
</xacro:macro>

<xacro:macro name="tangs_cintura" params="">

        <link name="${tf_prefix}/link_body">
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://tangs_description/models/thangs3/link_body.stl"/>
                </geometry>
                <material name="Gazebo/Grey"/>
            </visual>

            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>    
                   <!-- <cylinder radius="0.050" length="0.067" /> -->
                   <mesh filename="package://tangs_description/models/thangs3/link_body.stl"/>
                </geometry>
            </collision>

            <inertial>
                <origin xyz="-6.44e-03 1.36e-03 1.73e-02" rpy="0 0 0"/>
                <mass value="8.50e-02" />
                <inertia ixx="0.002" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.002" />
            </inertial>
        </link>

        <joint name="${tf_prefix}/waist" type="revolute">
            <origin xyz="0 0 5.60e-02" rpy="0 0 1.55" />
            <parent link="${tf_prefix}/link_base" />
            <child link="${tf_prefix}/link_body" />
            <axis xyz="0 0 1" />
            <limit effort="300" lower="-1.570796327" upper="1.570796327" velocity="3" />
            <dynamics damping="0.3" friction="0.0" />
        </joint>

        <gazebo reference="${tf_prefix}/link_body">
            <kp>${kp}</kp> <!-- static contact stiffness - very rigid, bigger values closes to the marble -->
            <kd>${kd}</kd> <!-- static dynamic stiffness very rigid, bigger values closes to the marble -->
            <mu1>${mu1}</mu1> <!-- Static Friction Coeficient -->
            <mu2>${mu2}</mu2> <!-- Dynamic Friction Coeficient -->
             <material>Gazebo/Grey</material>
            <selfCollide>true</selfCollide>   
        </gazebo>

        <xacro:transmission number="1" joint_name="${tf_prefix}/waist"/>

</xacro:macro>

<xacro:macro name="tangs_ombro" params="">

    <link name="${tf_prefix}/link_arm">
        <visual>
            <origin xyz="-5.77e-02 6.02e-04 0" rpy="${pi} 0 -${pi/2}" />
            <geometry>
                <mesh filename="package://tangs_description/models/thangs3/link_arm.stl"/>
            </geometry>
            <material name="Gazebo/Grey"/> 
        </visual>
        <collision>
            <origin xyz="-5.77e-02 6.02e-04 0" rpy="${pi} 0 -${pi/2}" />
            <geometry>
                <mesh filename="package://tangs_description/models/thangs3/link_arm.stl"/>
            </geometry>
        </collision>
        <inertial>
            <origin xyz="-5.92e-02 0 -7.79e-03" rpy="0 0 0"/>
            <mass value="8.50e-03" />
            <inertia ixx="0.002" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.002" />
        </inertial>
    </link>

    <joint name="${tf_prefix}/shoulder" type="revolute">
        <origin xyz="-4.00e-03 1.40e-02 4.03e-02" rpy="${pi/2} ${pi/2} -${pi/2}" />
        <parent link="${tf_prefix}/link_body" />
        <child link="${tf_prefix}/link_arm" />
        <axis xyz="0 0 1" />
         <limit effort="200" lower="-1.570796327" upper="1.570796327" velocity="3" />
        <joint_properties friction="0.0" /> 
    </joint>

    <gazebo reference="${tf_prefix}/link_arm">
        <kp>${kp}</kp>
        <kd>${kd}</kd> <!-- static dynamic stiffness very rigid, bigger values closes to the marble -->
        <mu1>${mu1}</mu1> <!-- Static Friction Coeficient -->
        <mu2>${mu2}</mu2> <!-- Dynamic Friction Coeficient -->
         <material>Gazebo/Grey</material>
        <selfCollide>true</selfCollide>   
    </gazebo>

    <xacro:transmission number="2" joint_name="${tf_prefix}/shoulder"/>
</xacro:macro>

<xacro:macro name="tangs_cotovelo" params="">

    <link name="${tf_prefix}/link_forearm">
    <visual>
        <origin xyz="0 -3.22e-02 6.00e-03" rpy="-${pi} 0 0" />
        <geometry>
            <mesh filename="package://tangs_description/models/thangs3/link_forearm.stl"/>
        </geometry>
       <material name="Gazebo/Grey"/>
    </visual>
    <collision>
        <origin xyz="0 -3.22e-02 6.00e-03" rpy="-${pi} 0 0" />
        <geometry>
            <mesh filename="package://tangs_description/models/thangs3/link_forearm.stl"/>
        </geometry>
    </collision>
    <inertial>
        <origin xyz="0 -3.93e-02 -7.40e-03" rpy="0 0 0"/>
        <mass value="5.28e-03" />
        <inertia ixx="0.002" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.002" />
    </inertial>
</link>

<joint name="${tf_prefix}/elbow" type="revolute">
  <origin xyz="-1.20e-01 0 0" rpy="${pi} 0 6.09e-01" />
  <parent link="${tf_prefix}/link_arm" />
  <child link="${tf_prefix}/link_forearm" />
  <axis xyz="0 0 1" />
  <limit effort="200" lower="-2.5" upper="0.6" velocity="3" />
  <joint_properties friction="0.0" />
</joint>

<gazebo reference="${tf_prefix}/link_forearm">
    <kp>${kp}</kp>  <!-- static contact stiffness - very rigid, bigger values closes to the marble -->
    <kd>${kd}</kd> <!-- static dynamic stiffness very rigid, bigger values closes to the marble -->
    <mu1>${mu1}</mu1> <!-- Static Friction Coeficient -->
    <mu2>${mu2}</mu2> <!-- Dynamic Friction Coeficient -->
     <material>Gazebo/Grey</material>
    <selfCollide>true</selfCollide>   
</gazebo>

    <xacro:transmission number="3" joint_name="${tf_prefix}/elbow"/>
</xacro:macro>

<xacro:macro name="tangs_punho_yaw" params="">

    <link name="${tf_prefix}/link_hand">
        <visual>
            <origin xyz="4.99e-03 -1.40e-02 -2.30e-02" rpy="-${pi/2} 0 0" />
            <geometry>
                <mesh filename="package://tangs_description/models/thangs3/link_hand.stl"/>
            </geometry>
             <material name="Gazebo/Grey"/>
        </visual>
        <collision>
            <origin xyz="4.99e-03 -1.40e-02 -2.30e-02" rpy="-${pi/2} 0 0" />
            <geometry>
                <mesh filename="package://tangs_description/models/thangs3/link_hand.stl"/>
            </geometry>
        </collision>
        <inertial>
            <origin xyz="5.03e-03 -6.14e-03 -1.77e-02" rpy="0 0 0"/>
            <mass value="1.83e-03" />
            <inertia ixx="0.002" ixy="0.0" ixz="0.0" iyy="0.02" iyz="0.0" izz="0.002" />
        </inertial>
    </link>

    <joint name="${tf_prefix}/wrist_yaw" type="revolute">
        <origin xyz="-5.31e-03 -8.97e-02 -7.51e-03" rpy="-${pi/2} 0 0" />
        <parent link="${tf_prefix}/link_forearm" />
        <child link="${tf_prefix}/link_hand" />
        <axis xyz="0 0 1" />
        <limit effort="200" velocity="20" lower="-${pi/2}" upper="${pi/2}" />
        <joint_properties friction="0.0" />
    </joint>

    <gazebo reference="${tf_prefix}/link_hand">
        <kp>${kp}</kp> <!-- static contact stiffness - very rigid, bigger values closes to the marble -->
        <kd>${kd}</kd> <!-- static dynamic stiffness very rigid, bigger values closes to the marble -->
        <mu1>${mu1}</mu1> <!-- Static Friction Coeficient -->
        <mu2>${mu2}</mu2> <!-- Dynamic Friction Coeficient -->
       <material name="Gazebo/Grey"/>
        <selfCollide>true</selfCollide> 
    </gazebo>

    <xacro:transmission number="4" joint_name="${tf_prefix}/wrist_yaw"/>
</xacro:macro>



<xacro:macro name="tangs_punho_pitch" params="">

    <joint name="${tf_prefix}/wrist_pitch" type="revolute">
        <origin rpy="0 -3.81e-02 0" xyz="0.00 -1.40e-02 -2.80e-02" />
        <parent link="${tf_prefix}/link_hand" />
        <child link="${tf_prefix}/palm_link" /> <!-- Nome do link inicial do gripper-->
        <axis xyz="0 1 0" />
        <limit effort="200" velocity="20" lower="${-pi}" upper="${0}" />
        <joint_properties friction="0.0" />
    </joint>

    <gazebo reference="${tf_prefix}/palm_link">
        <kp>${kp}</kp> <!-- static contact stiffness - very rigid, bigger values closes to the marble -->
        <kd>${kd}</kd> <!-- static dynamic stiffness very rigid, bigger values closes to the marble -->
        <mu1>${mu1}</mu1> <!-- Static Friction Coeficient -->
        <mu2>${mu2}</mu2> <!-- Dynamic Friction Coeficient -->
        <material>Gazebo/Grey</material>
        <selfCollide>true</selfCollide>   
    </gazebo>

    <xacro:transmission number="5" joint_name="${tf_prefix}/wrist_pitch"/>
</xacro:macro>

<xacro:macro name="transmission" params="number joint_name">
        
        <transmission name="tran${number}">
            <type>transmission_interface/SimpleTransmission</type>
            
            <joint name="${joint_name}">
                <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface> 
            </joint>
            <actuator name="motor${number}">
                <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
                <mechanicalReduction>1</mechanicalReduction>
            </actuator>

        </transmission>
</xacro:macro>

    <xacro:macro name="tangs_control" params="namespace">
            <gazebo>
                <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
                    <robotNamespace>/</robotNamespace>
                </plugin>
            </gazebo>
    </xacro:macro>

    <!-- Math Usefull MACROS-->
    <xacro:macro  name="cylinder_inertia" params="mass r l">     
         <inertia  ixx="${mass*(3*r*r+l*l)/12}" ixy = "0" ixz = "0"
                  iyy="${mass*(3*r*r+l*l)/12}" iyz = "0"
                  izz="${mass*(r*r)/2}" />
    </xacro:macro >

    <xacro:macro name="box_inertia" params="mass x y z">
        <inertia  ixx="${mass*(y*y+z*z)/12}" ixy = "0" ixz = "0"
                    iyy="${mass*(x*x+z*z)/12}" iyz = "0"
                    izz="${mass*(x*x+z*z)/12}" />
    </xacro:macro>

    <xacro:macro name="sphere_inertia" params="mass r">
        <inertia  
            ixx="${2*mass*r*r/5}" ixy = "0" ixz = "0"
            iyy="${2*mass*r*r/5}" iyz = "0"
            izz="${2*mass*r*r/5}" />
    </xacro:macro>  

    <!-- Chamada das macros para geração do braço robótico -->

    <xacro:tangs_base />
    <xacro:tangs_cintura />
    <xacro:tangs_ombro />
    <xacro:tangs_cotovelo />
    <xacro:tangs_punho_yaw /> 
    <xacro:gripper parent_link="${tf_prefix}/link_hand" /> 
    <xacro:tangs_punho_pitch />

    <xacro:tangs_control namespace="$(arg robot_name)"/>
    
</robot>







